<html>
<head>
<title>PAIR MANIA</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!-- Bootstrap CSS -->
	<link type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <!-- font Awesome CSS -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

	<link rel="stylesheet" href="/js/TimeCircles.css" />
    <!-- Main Styles CSS -->
    <link href="/css/main.css" rel="stylesheet">
	
	<link rel="stylesheet" href="/css/swiper.css">
	 <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://cdn.rawgit.com/julianshapiro/velocity/master/velocity.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
	<!-- Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<!-- Custom JavaScript -->	
	<script type="text/javascript" src="/js/TimeCircles.js"></script>
	<script type="text/javascript" src="/js/counter.js"></script>
	<script src="/js/swiper.min.js"></script>
    <script src="/js/ion.sound.js"></script>
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<script>
		var playername = '';
		var playerimg = '';
		var pairmania_userid = 0;
	</script>
	<style>
.w3-sidebar{height:100%;width:200px;background-color:#fff;position:fixed!important;z-index:1000;overflow:hidden}
.w3-bar-block .w3-dropdown-hover,.w3-bar-block .w3-dropdown-click{width:100%}
.w3-bar-block .w3-dropdown-hover .w3-dropdown-content,.w3-bar-block .w3-dropdown-click .w3-dropdown-content{min-width:100%}
.w3-bar-block .w3-dropdown-hover .w3-button,.w3-bar-block .w3-dropdown-click .w3-button{width:100%;text-align:left;padding:8px 16px}
.w3-bar{width:100%;overflow:hidden}.w3-center .w3-bar{display:inline-block;width:auto}
.w3-bar .w3-bar-item{padding:8px 16px;float:left;width:auto;border:none;outline:none;display:block}
.w3-bar .w3-dropdown-hover,.w3-bar .w3-dropdown-click{position:static;float:left}
.w3-bar .w3-button{white-space:normal}
.w3-bar-block .w3-bar-item{width:100%;display:block;padding:8px 16px;text-align:left;border:none;outline:none;white-space:normal;float:none}
.w3-bar-block.w3-center .w3-bar-item{text-align:center}.w3-block{display:block;width:100%}
.w3-tiny{font-size:10px!important}.w3-small{font-size:12px!important}.w3-medium{font-size:15px!important}.w3-large{font-size:18px!important}
.w3-button:hover{color:#000!important;background-color:#ccc!important}
a{background-color:transparent;-webkit-text-decoration-skip:objects}
a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}
.w3-btn,.w3-button{border:none;display:inline-block;outline:0;padding:8px 16px;vertical-align:middle;overflow:hidden;text-decoration:none;color:inherit;background-color:inherit;text-align:center;cursor:pointer;white-space:nowrap}
.w3-btn:hover{box-shadow:0 8px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19)}
.w3-btn,.w3-button{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}   
@media (max-width:992px){.w3-sidebar.w3-collapse{display:none}.w3-main{margin-left:0!important;margin-right:0!important}}

a.blurimage:before{
	content:url('/guess.png');;
	position: absolute;
	top: 0px;
	display: block;
    background:url('/guess.png');
}
</style>

	<style>
		
		.borderRed{
			border: 1px solid red;
		}
		
		.borderGreen{
			border: 1px solid green;
			animation: blinker 2s linear 5 ;
			
		}
		
		@keyframes blinker {  
		  10% { opacity: 0; }
		}
		
		.div2 {
			width: 69px;
			height: 69px;
			padding: 10px;
			border: 1px solid green;
		}
		
		.drag_me{
		-webkit-user-drag: element;
	}

	.hidepannel{
		/*visibility:hidden;*/
		display: none;
	}
	
	.div1 {
		height:180px !important;
	}
	.draggable .thumbnail{
		width:135px;
		height:160px;
		}	
	.draggable .thumbnail img{
		width:132px;
		height:150px;
		}		
	.media-object{
		height:45px !important;
	}	
	#oppbattle{
		 overflow-x: scroll;
	}
	
	#oppbattle::-webkit-scrollbar-track
	{
		-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
		background-color: #F5F5F5;
	}

	#oppbattle::-webkit-scrollbar
	{
		width: 2px;
		background-color: #F5F5F5;
	}

	#oppbattle::-webkit-scrollbar-thumb
	{
		background-color: #000000;
		border: 1px solid #555555;
	}
	
	#mybattle{
		 overflow-x: scroll;
	}
	#mybattle::-webkit-scrollbar-track
	{
		-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
		background-color: #F5F5F5;
	}

	#mybattle::-webkit-scrollbar
	{
		width: 2px;
		background-color: #F5F5F5;
	}

	#mybattle::-webkit-scrollbar-thumb
	{
		background-color: #000000;
		border: 1px solid #555555;
	}
	</style>
	<link type="text/css" href="http://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css" rel="stylesheet" /> 
	
</head>
<body style="overflow-x:hidden">
<% if (!user) { %>

<div id="wrapper" class="text-center">
	<div class="main">
			<div class="row">
				<div class="col-md-12">  
				  <div id="login">
					<div class="logo"><img src="/Pair-Mania.png" width=280>
						<form id="loginForm" action="/loginForm" method="get">
							<input type="text" name="displayName" id="username" Placeholder="Username" required>
							<input class="btn btn-primary btn-block" type="submit" value="Play">
							<a href="/auth/facebook" class="btn btn-success btn-block fb_btn"></a>
						</form>
					<div class="clearfix"></div>
					</div> <!-- end login -->
				</div>
			</div>	
		</div>
	</div>
</div>	

<% } else if (user.status=="eligible") { %>
<input type="hidden" id="pairmania_userid" name="pairmania_userid" value="<%= user.pairmania_id %>"/>
<div id="gamearea">
<div id="mySidenav" class="w3-sidebar w3-bar-block w3-border-right sidenav" style="display:none">
  <div class="row" onclick="closeNav()">
		<div style="padding:5px 10px 5px 10px;background:#616161!important;color:#fff!important">
		<div class="media-left">
			<a href="javascript:void(0)">
				<img id="profile" class="media-object" src="<%= user.photos %>" alt="profile picture" height=50 >
			</a>
		</div>
		<div class="media-body">
			<h4><strong class="singleuser"><%= user.displayName %></strong></h4>
		</div>
		<div class="media-right">
			<a href="javascript:void(0)" onclick="closeNav()" style="color:#fff!important"><i class="glyphicon glyphicon-remove-sign"></i></a>
		</div>
		</div>
  </div>
  <div class="row" id="onlinebattleplayers"></div>
</div>

<div id="mySidenav_scorecard" class="w3-sidebar w3-bar-block w3-border-right sidenav" style="display:none">
    <div class="row" onclick="closescoreNav()">
		<div style="padding:5px 5px 5px 15px;background:#616161!important;color:#fff!important">
			<h4>Players ScoreCard&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-remove-sign"></span></h4>
		</div>
  </div>
  <div class="row" id="displayResult" style="max-height:700px;overflow-y:scroll;">
	
  </div>
</div>

<script>
function openNav() {
    document.getElementById("mySidenav").style.display = "block";
}
function closeNav() {
    document.getElementById("mySidenav").style.display = "none";
}

function openscoreNav() {
    document.getElementById("mySidenav_scorecard").style.display = "block";
}
function closescoreNav() {
    document.getElementById("mySidenav_scorecard").style.display = "none";
}
</script>

<div id="main">
  	<div class="panel panel-default">
		    <div class="panel-heading" style="padding:0px;overflow:hidden;">	
			    <div class="pull-right" id="CountDownTimer" data-timer="300" style="width:auto;height:50px;margin-right:5px;margin-top:-5px;"></div>
				<h3 class="panel-title">
				    <ul class="nav nav-pills" style="height:35px;">
					  <li role="presentation"><a id="menuToggler" type="button" href="javascript:void(0);" onclick="openNav()" title="Invite Player"><span class="glyphicon glyphicon-plus"></span></a></li>
					  <li role="presentation"><a type="button" href="javascript:void(0);" title="Player joined"><span class="glyphicon glyphicon-user"></span><span class="badge" id="count" style="line-height:none;"></span></a></li>
					  <li role="presentation"><a type="button" href="../" title="Leave The Room"><span class="glyphicon glyphicon-off"></span></a></li>
					</ul>
				</h3>
			</div>
			<div class="panel-body">	
			<div  id="battleplayers" class="row"></div>
			<div  class="row">
				<div id="targetOutcome" class="col-md-12 col-sm-12 col-xs-12"></div>
			</div>
			<div  class="row">
				<div class="col-md-12 col-sm-12 col-xs-12" id="writeFinalResult"></div>
				<div class="text-center col-md-12 col-sm-12 col-xs-12"><div id="players"></div></div>
				<div class="col-md-12 col-sm-12 col-xs-12" id="restartGame" style="margin:5px;"></div> 
			</div>
			
			<div class="row">
				<div id="getAllpairs">		
					<div id="currentuser" style="margin-top:10px;">
						
					</div>
				</div>
			</div>
			<div class="row">
				<div id="conversation" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="max-height:300px;overflow-y:scroll;"></div>
			</div>
			<div class="row">
			  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
				<div class="input-group">
				  <input type="text" id="data" class="form-control" placeholder="CHAT">
				  <span class="input-group-btn">
					 <button class="btn btn-default" id="datasend" type="button">SEND</button>
				  </span>
				</div><!-- /input-group -->
			  </div><!-- /.col-lg-6 -->
			</div><!-- /.row -->	
		  </div>
		</div>
    </div>
</div>

 <script>
  
	$(document).ready(function(){
	    $('#gamesound').hide();
		ion.sound({
            sounds: [
                {name: "clock"},
                {name: "Retro-Frantic_V001_Looping"},
				{name: "switch"},
				{name: "happykids"},
				{name: "Puzzle-Dreams-3"}
            ],
            path: "/",
            preload: true,
            volume: 1.0
        });
		 
		socket.on('connect', function(){
		    ion.sound.play("Puzzle-Dreams-3");
		    playername=$('.singleuser').html();
			playerimg = $('#profile').attr('src');
			pairmania_userid = $('#pairmania_userid').attr('value');
			
			socket.emit('battleplay',
			{
				Playerusername : playername, 
				Playerimg : playerimg, 
				pairmania_id : pairmania_userid,
				PlayerSocketId : socket.id
			});				
		
		});
	
	});
	
	function getpairs(){
			var oldval=0;
			var match=0;
			var imgcnt =1;
			var playercount = $("#count").text();
			
			var arraysOfIds = $('#getAllpairs img').map(function(){
                       return $(this).attr('img-val');
                   }).get();
				   
			if(arraysOfIds.length == roomlimit){
				for(var i=0;i<arraysOfIds.length;i++){
					
					var newval=arraysOfIds[i];
					
					if(i==0){
						oldval = newval;
					}else{
						if(oldval == newval){
							match=1;
							imgcnt=imgcnt+1
						}else{
							match=0;
							i=arraysOfIds.length;
						}
					}				
				} 
			}
			
			if(match){
				socket.emit('winner', {
					srcsocketId:socket.id,
					playername:playername,
					playerPlaying:playerPlaying,
					roomlimit:roomlimit,
					imgval:oldval,
					imgcnt:imgcnt,
					rank:rank
				});
				
			}
		}
</script>

<script src="/js/battleclient.js"></script>	
<% } else if (user.status=="not eligible") { %>
<div class="row">
	<div class="container">
		<div class="jumbotron">
			<h1>Sorry <%= user.displayName %>, You are not elible for battle round.</h1>
			<p>You have less than 10 paired image. Please collect more paired image</p>
			<p>Score : <span class="badge"><%= user.score %></span></p>
			<p>Paired Image Count : <span class="badge"><%= user.pairs %></span></p>
			<p><a class="btn btn-primary btn-lg" href="../" role="button">Back to home</a></p>
		</div>
	</div>
</div>	
<% } %>
</body>
</html>
